#!/bin/sh
# GitLeaks Pre-commit Hook
# Previne que secrets sejam commitados

GITLEAKS_BINARY=$(which gitleaks)

if [ -z "$GITLEAKS_BINARY" ]; then
    echo "âŒ GitLeaks nÃ£o estÃ¡ instalado"
    echo "ğŸ“¦ Para instalar: choco install gitleaks (Windows) ou brew install gitleaks (macOS)"
    exit 0
fi

echo "ğŸ” Verificando secrets com GitLeaks..."
gitleaks detect --source . --exit-code 1 --log-level error

if [ $? -eq 1 ]; then
    echo "âŒ GitLeaks detectou secrets potenciais!"
    echo "âš ï¸  Commit abortado. Remova os secrets antes de fazer commit."
    echo "ğŸ’¡ Use: gitleaks detect --source . --verbose para mais detalhes"
    exit 1
fi

echo "âœ… Nenhum secret detectado!"
exit 0
